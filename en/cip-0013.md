
| cip  | title                                       | author | status |
| ---- | ------------------------------------------- | ------ | ------ |
| 0013 | Wallet App scans QR Code for authentication |        | Draft  |

## Abstract

Nowadays it is very commont to use mobile App to scan QR Code on a web site for authentication. Most popular web sites have corresponding mobile Apps. When you want to login to a web site on PC, you use mobile App to scan QR Code. It is more secure and convenience than using password to login. This feature is also used for third-party login. For example, you can use WeChat to login many web sites by scanning QR Code. 

This CIP describes how to use CoinEx Chain's wallet to implement similiar function: authenticate for an account existing on CoinEx Chain.

## Background

An account on CoinEx Chain can have aliases with good readability. And wallet App can securely keep the private key. The alias of an account can be used as user name when login to some web site. And the signatures generated using the private key, can be used for authentication. So, a wallet App have enough infrustrure to implement "Scanning QR Code for login".

## Motivation

This CIP standarlized the data formats and operations which are used in authentication through QR Code. Thus different wallet Apps and websites can interact with each other smoothly.

## Specification

A web site should show a URI through the QR Code. And the format of the URI should beï¼š

```
cet://authorize/<hex-rand-num>/<alias>?target=<url>
```

In this URI, `hex-rand-num` is a 160-bit random number in hex encoding; `url` is a http url, in [Percent Encoding](https://en.wikipedia.org/wiki/Percent-encoding); `alias` is the alias of some account of CoinEx Chain, it can be empty if the web site does not want to indicate a concrete account.

After receiving this URI after scanning QR Code, the wallet App should do the following tasks:

1. If the `alias` is not empty, it checks whether it keeps the corresponding account's private key. If not, it should report error to user. If the `alias` is empty, it should ask user to choose an account for authentication.
2. Generate a 256-bit true random number `local-rand-num`.
3. Present the `local-rand-num` and `hex-rand-num` as byte slices (in little endian), concat them together and use blake2b-256 algorithm to get a hash value. Then use the account selected in step 1 to sign this hash avalue.
4. Send a HTTP POST reques to the above `url`. There are four lines in the request's body: the first line is `hex-rand-num`; the second line is the user's alias; the third line is `local-rand-num`; the fourth line is the signature, in base64 encoding. The web site should check the signature after receiving the request. If the check passes, the web site sends "200 OK" HTTP Response.

The specified URI can be also be used as a normal http link, instead of a QR Code. Thus, on a cell phone, user can click a http link of a web site to start a App, which will do the authentication task for this web site.
